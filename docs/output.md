# nf-core/icgcargomutsig: Output

## Introduction

This document describes the output produced by the pipeline. Most of the plots are taken from the MultiQC report, which summarises results at the end of the pipeline.

The directories listed below will be created in the results directory after the pipeline has finished. All paths are relative to the top-level results directory.

## Pipeline overview

The pipeline is built using [Nextflow](https://www.nextflow.io/) and processes data using the following steps:

- [SigProfilerMatrixgenerator](#SigProfilerMatrixgenerator) - Installation of the required reference genome build and assignment of mutations to the COSMIC SBS96 trinucleotide context
- [SigProfilerAssignment](#SigProfilerAssignment) - Assignment of mutations to SBS, DBS and InDel context including quality metric assessment and decomposition plots as generated by [SigProfiler](https://osf.io/t6j7u/wiki/4.%20Using%20the%20Tool%20-%20Output/)
- [signature.tools.lib](#signature.tools.lib) - Assignment of mutations to the Nik-Zainal et al.-derived COSMIC catalogue for the SBS96 context
- [Error thresholding](#ErrorThresholding) - Calculations of per-cohort error estimates (KL, RSME, Hellinger and SAD)
- [MultiQC](#multiqc) - Aggregates run information describing the used CLI commands and package versions for reproducebility
- [Pipeline information](#pipeline-information) - Reports metrics generated during workflow execution

### SigProfilerMatrixgenerator

<details markdown="1">
<summary>Output files</summary>

- `matrixgenerator/`
  - `Trinucleotide_matrix_{output_pattern}_SBS96.txt`: Assignment of input data mutations to the SBS96 trinucleotide context in tsv-format with rows representing the respective context and each column representing the patient/sample-level assignments
  - `Trinucleotide_matrix_{output_pattern}_DBS78.txt`: Assignment of input data mutations to the DBS78 double base substitution context in tsv-format with rows representing the respective context and each column representing the patient/sample-level assignments
  - `Trinucleotide_matrix_{output_pattern}_ID83.txt`: Assignment of input data mutations to the ID83 insertion/deletion context in tsv-format with rows representing the respective context and each column representing the patient/sample-level assignments

</details>

The [SigProfilerMatrixGenerator](https://osf.io/s93d5/wiki/home/) module installs the required genome build provided by _--ref_ and assigns all found mutations per sample to the SBS96, DBS78 and ID83 context. The resulting matrices follow the overall formatting structure for the majority of signature assignment tools and can thus be used for alternative software packages.

### SigProfilerAssignment

<details markdown="1">
<summary>Output files</summary>

- `assignment/output/`
  - `Assignment_Solution`: This folder contains the activities, signatures and solution stats for the assignment of mutations to the COSMIC catalogue as done by [SigProfilerAssignment](https://osf.io/mz79v/wiki/home/).
    - The **activities** folder contains the absolute number of mutations per sample associated with each signature, plots visualizing the signature association and the assumed TMB per sample and the fractional count of each trinucleotide context per sample and signature.
    - The **signatures** folder contains the fractional count for each trinucleotide context per signature and a plot showing the assignment solutions.
    - The **solution stats** folder contains statistical values derived from the signature fitting procedure, including the cosine similarity, L1 and L2 norm and the KL Divergence per sample, and the per sample signature decomposition statistics.
  - `JOB_METADATA_SPA.txt`: This TXT-file contains information on the used versions of each python module used, the settings given to

</details>

The [SigProfilerAssignment](https://osf.io/mz79v/wiki/home/) module performs signature fitting of input exposures to the SBS96, DBS78 and ID83 signature catalogue of the **COSMIC v.3.4.** database, additionally generating QC data to evaluate the performance of signature assignments in each step. The SigProfiler package generates plots concerning the TMB per sample and the fractional assignment of mutations to signatures per sample, easily visualizing differences in the datasets. Exposure assignments are given out as tab-seperated matrices, with rows representing the samples and columns representing the signatures.

### signature.tools.lib

<details markdown="1">
<summary>Output files</summary>

- `signaturetoolslib/`
  - `{output_pattern}.json`: Assignment solutions as generated by the [signature.tools.lib package](https://github.com/Nik-Zainal-Group/signature.tools.lib) against the adapted COSMIC catalogue for 30 signatures using the **Fit** function. The assignments are given as JSON and include the metadata of parameters used for the signature assignments, raw counts considered per sample for signature fitting, cosine similarity values between the catalogue and the reconstructed assignments per sample and the fractional assignments of mutations to the catalogue per sample.

</details>

The [signature.tools.lib package](https://github.com/Nik-Zainal-Group/signature.tools.lib) generates signature assignments based on an adapted signature catalogue generated by [Andrea Degasperi and Serena Nik-Zainal](https://www.nature.com/articles/s43018-020-0027-5) and outputs the results in JSON format. Currently, only the **Fit**-function is supported.

### Error thresholding

<details markdown="1">
<summary>Output files</summary>

- `errorthresholding/`
  - `{output_pattern}_errors.json`: Error estimates describing the Kullback-Leibler-Divergence (**KL**), root-mean square error (**RMSE**), sum of absolute differences (**SAD**) and the **Hellinger Distance** in JSON format.

</details>

The error thresholding module takes the input trinucleotide matrix of the [SigProfilerMatrixgenerator](#SigProfilerMatrixgenerator) module and the exposure estimates from [signature.tools.lib](#signature.tools.lib) and estimates error statistics on the input dataset.

### MultiQC

<details markdown="1">
<summary>Output files</summary>

- `multiqc/`
  - `multiqc_report.html`: a standalone HTML file that can be viewed in your web browser.
  - `multiqc_data/`: directory containing parsed statistics from the different tools used in the pipeline.
  - `multiqc_plots/`: directory containing static images from the report in various formats. With this current pipeline version, no plots are generated.

</details>

[MultiQC](http://multiqc.info) is a visualization tool that generates a single HTML report summarising all samples in your project. Most of the pipeline QC results are visualized in the report and further statistics are available in the report data directory. Software and package version can be found in the **MultiQC report** for reproducibility.

Results generated by MultiQC collate pipeline QC from supported tools e.g. FastQC. The pipeline has special steps which also allow the software versions to be reported in the MultiQC output for future traceability. For more information about how to use MultiQC reports, see <http://multiqc.info>.

### Pipeline information

<details markdown="1">
<summary>Output files</summary>

- `pipeline_info/`
  - Reports generated by Nextflow: `execution_report.html`, `execution_timeline.html`, `execution_trace.txt` and `pipeline_dag.dot`/`pipeline_dag.svg`.
  - Reports generated by the pipeline: `pipeline_report.html`, `pipeline_report.txt` and `software_versions.yml`. The `pipeline_report*` files will only be present if the `--email` / `--email_on_fail` parameter's are used when running the pipeline.
  - Reformatted samplesheet files used as input to the pipeline: `samplesheet.valid.csv`.

</details>

[Nextflow](https://www.nextflow.io/docs/latest/tracing.html) provides excellent functionality for generating various reports relevant to the running and execution of the pipeline. This will allow you to troubleshoot errors with the running of the pipeline, and also provide you with other information such as launch commands, run times and resource usage.
